# 更新日志

## [2.3.0] - 2025-12-29

### 🎉 重大更新：统一报告UI/UX重构
- **数据杂志风格**：将文本报告和可视化报告整合为统一的"数据杂志"风格页面
- **信息密度优化**：整个报告压缩到2-3屏内显示，第一屏包含所有核心信息
- **移动端优化**：3秒内看懂所有关键信息，适合截图分享到社交媒体

### ✨ 新增功能
- **统一报告组件**：UnifiedReport组件整合文本和可视化数据
- **人设标签展示**：从报告中提取核心人设标签，醒目展示
- **行动清单样式**：将行动建议改为checklist清单样式
- **霓虹色点缀**：添加电光紫(#8e2de2)作为主题色
- **噪点纹理背景**：增加轻微噪点纹理提升质感
- **并行生成报告**：同时生成文本和可视化数据，提升效率

### 🎨 UI/UX改进
- **移除模式选择**：不再需要在文本/可视化之间选择
- **Bento Grid布局**：8维度卡片紧凑排列（移动端1列、平板2列、桌面4列）
- **关键数字突出**：评分使用大字号粗体显示
- **装饰性光效**：添加渐变光效增强视觉层次
- **一键下载图片**：支持将整个报告保存为图片

### 🔧 技术优化
- 简化状态管理，移除reportMode状态
- 优化缓存结构，移除不必要的字段
- 改进报告生成逻辑，使用Promise.all并行请求

---

## [2.2.0] - 2025-12-29

### 🎉 重大更新
- **页面缓存机制**：自动保存用户输入的基本信息，避免重复输入
- **Bento Grid可视化报告**：新增卡片式命理仪表盘，8个维度直观展示
- **报告持久化**：刷新页面后报告数据不丢失，24小时内有效

### ✨ 新增功能
- **表单数据缓存**：自动保存年月日时、性别、昵称等基本信息
- **报告数据缓存**：自动保存八字数据、文本报告、可视化报告
- **智能恢复**：刷新页面后自动恢复到上次的状态（步骤、报告、模式）
- **缓存过期机制**：报告缓存24小时后自动过期清除
- **清除缓存按钮**：一键清空所有缓存数据并重置表单
- **可视化报告组件**：采用Bento Grid布局，响应式设计
- **8维度分析卡片**：
  - 交易运势 - 投资理财能力分析
  - 性格分析 - 基于日主的性格特征
  - 事业行业 - 适合的职业方向
  - 发展风水 - 有利的方位和颜色
  - 财富层级 - 财运分析和时机
  - 婚姻情感 - 感情运势分析
  - 身体健康 - 需要注意的健康问题
  - 六亲关系 - 家庭关系分析
- **报告模式切换**：支持文本报告和可视化报告自由切换
- **双报告生成**：可同时生成文本和可视化两种格式

### 🎨 UI优化
- 卡片悬停动画效果
- 渐变色主题配色
- 评分进度条可视化
- 响应式网格布局（移动端1列，平板2列，桌面3列）

### 🛠️ 技术改进
- 后端支持 `outputFormat` 参数（text/visual）
- 新增 `prompt-visual.ts` 结构化输出模板
- 新增 `VisualReportData` 类型定义
- API新增 `generateVisualReport` 函数

### 📁 文件变更
- 新增：`src/components/VisualReport.tsx`
- 新增：`supabase/functions/generate-report/prompt-visual.ts`
- 修改：`src/components/InputForm.tsx`（缓存逻辑）
- 修改：`src/pages/HomePage.tsx`（集成可视化报告）
- 修改：`src/services/api.ts`（新增API函数）
- 修改：`src/types/types.ts`（新增类型定义）
- 修改：`supabase/functions/generate-report/index.ts`（支持双格式输出）

---

## [2.1.0] - 2025-12-29

### 🎯 Prompt优化
- **新增天干意象库**：为十天干（甲乙丙丁戊己庚辛壬癸）提供具体的意象描述
- **新增金句示例**：提供4个金句参考，提升输出质量
- **明确长度要求**：每个部分150-250字，金句15-25字
- **优化输出指令**：简化风格约束，更易于AI理解
- **重构prompt结构**：将prompt提取到独立文件 `prompt-template.ts`

### ✨ 新增功能
- **日期手动输入**：年月日改为输入框，支持直接输入数字，不再需要滚动选择

### 🛠️ 修复
- 修复四柱八字无法显示的问题（数据结构不匹配）
- 修复五行映射错误（午 → 火）
- 更新 `BaziData` 类型定义，添加出生信息字段
- 修改 `bazi.ts` 返回农历信息

### 📁 文件变更
- 新增：`supabase/functions/generate-report/prompt-template.ts`
- 修改：`supabase/functions/generate-report/index.ts`（引用新prompt）
- 修改：`src/components/InputForm.tsx`（日期输入优化）
- 修改：`src/components/BaziDisplay.tsx`（修复显示问题）
- 修改：`src/types/types.ts`（添加字段）
- 修改：`src/services/bazi.ts`（返回农历）

---

## [2.0.0] - 2025-12-29

### 🎉 重大更新
- **实现两步流程设计**：步骤1（八字排盘）→ 步骤2（AI分析）
- **新增步骤指示器组件** `StepIndicator.tsx`：显示当前进度，带动画效果
- **新增八字排盘展示组件** `BaziDisplay.tsx`：美观展示四柱、五行、出生信息
- **移除主页面授权码验证**：用户在授权页验证一次后，直接进入主功能

### ✨ 新增功能
- 八字排盘结果展示（四柱、五行分析、出生信息）
- 五行颜色标注（木绿、火红、土黄、金金、水蓝）
- 农历日期自动转换显示
- 步骤指示器（圆形图标 + 连接线 + 完成标记）
- **日期支持手动输入**：年月日改为输入框，不再需要滚动选择

### 🎨 UI/UX 优化
- 表单标签更规范："姓名（可选）"、"出生日期（公历）"、"出生时间"、"性别"
- 按钮文案更明确："✨ 开始排盘"、"✨ 启动AI分析"
- 卡片式布局，渐变背景，毛玻璃效果
- 输入框更大（h-11），提升触控体验
- **日期输入优化**：支持直接输入数字，带范围限制（年：1900-2100，月：1-12，日：1-31）

### 🛠️ 修复
- 修复 `BaziDisplay` 组件无法显示天干地支的问题
- 修复五行映射错误（午 → 火）
- 更新 `BaziData` 类型定义，添加出生信息字段

### 📁 文件变更
- 新增：`src/components/StepIndicator.tsx`
- 新增：`src/components/BaziDisplay.tsx`
- 新增：`更新日志-V2.md`
- 修改：`src/components/InputForm.tsx`（完全重写）
- 修改：`src/pages/HomePage.tsx`（实现两步流程）
- 修改：`src/types/types.ts`（添加出生信息字段）
- 修改：`src/services/bazi.ts`（返回农历信息）

---

## [1.1.0] - 2025-12-29

### 新增功能 ✅
- 新增长图报告组件 `ReportLongImage.tsx`，支持主图封面 + 霓虹波形图 + 雷达图 + 胶囊卡片的版式
- 首页报告展示切换为长图模式（`HomePage.tsx`）

### 修复 🛠️
- 修复 `InputForm` 报错：`handleValidateCode is not defined`
- 恢复通行码验证、情绪输入与完整表单校验流程

### 样式更新 🎨
- 新增 A 主图 / C 正文混搭风的样式块（`index.css`）

## [1.0.0] - 2025-12-29

### 新增功能 ✨

#### 授权码验证系统
- 创建独立的授权码验证页面（`AuthPage.tsx`）
- 首次访问需要输入授权码
- 验证通过后保存到 localStorage，永久生效
- 自动检测已保存的授权码，无需重复验证
- 优雅的验证界面，包含测试授权码提示

#### 简化用户体验
- 去除了"发射信号"（情绪文本输入框）
- 用户只需填写基本信息：
  - 出生年月日时
  - 性别
  - 时间不详选项
- 系统自动使用默认分析请求："请帮我分析一下我的性格特点和当前的人生阶段。"

### 改进 🔧

#### 路由优化
- `/` - 授权码验证页面（首页）
- `/home` - 主功能页面（需验证后访问）

#### 代码优化
- 移除未使用的 `Textarea` 组件导入
- 简化表单数据结构，移除 `emotionText` 字段
- 优化表单验证逻辑

### 文档更新 📝

- 创建新的 `README_NEW.md`，包含最新功能说明
- 更新 `TODO.md`，记录新增的优化步骤
- 删除未来规划功能描述（V2.1, V2.2, V2.3）
- 聚焦 MVP 核心功能

### 技术细节

#### 授权码本地存储
```typescript
const AUTH_CODE_KEY = 'cyber_healer_auth_code';
localStorage.setItem(AUTH_CODE_KEY, code);
```

#### 默认情绪文本
```typescript
const defaultEmotionText = '请帮我分析一下我的性格特点和当前的人生阶段。';
```

### 测试授权码

- `CYBER2025` - 100次使用，30天有效期
- `HEALER888` - 50次使用，60天有效期
- `TEST123` - 10次使用，7天有效期

---

## 设计理念

### 为什么去除情绪文本输入？

1. **降低使用门槛**：用户往往不知道如何描述自己的情绪
2. **减少决策疲劳**：填写表单已经需要思考，再要求描述情绪会增加负担
3. **提高转化率**：简化流程可以提高用户完成率
4. **保持核心价值**：八字分析本身已经足够提供有价值的洞察

### 为什么使用授权码验证？

1. **控制访问**：通过授权码控制使用次数和有效期
2. **用户体验**：验证一次，永久生效，不打扰用户
3. **灵活管理**：可以为不同用户群体发放不同的授权码
4. **成本控制**：避免 API 滥用，控制 Gemini API 调用成本

---

© 2025 赛博疗愈师 · 用科技连接心灵
